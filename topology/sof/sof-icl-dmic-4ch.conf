








SectionData."SOF_ABI" {
	bytes "0x03,0x0b,0x00"
}
SectionManifest.STR(sof_manifest) {
	data [
		SOF_ABI
	]
}
#
# Topology for ICL Lake with direct attach digital microphones array
#

# Include topology builder




































 
























# Include TLV library
# TLV
#
# Common TLV control ranges
#

SectionTLV."vtlv_m64s2" {
	Comment "-64dB step 2dB"

	scale {
		min "-6400"
		step "200"
		mute "1"
	}
}

SectionTLV."vtlv_m50s1" {
	Comment "-50dB step 1dB"

	scale {
		min "-5000"
		step "100"
		mute "1"
	}
}


# Include Token library

#
# SOF Tokens for differentiation.
#
# Differentiation can be done at the platform and machine level.
#
# Tokens are GUIDs

# TODO: pre-process this with UAPI headers GNU cpp.


SectionVendorTokens."sof_buffer_tokens" {
	SOF_TKN_BUF_SIZE			"100"
	SOF_TKN_BUF_CAPS			"101"
}

SectionVendorTokens."sof_dai_tokens" {
# Token retired with ABI 3.2, do not use for new capabilities
#	SOF_TKN_DAI_DMAC_CONFIG			"153"
	SOF_TKN_DAI_TYPE			"154"
	SOF_TKN_DAI_INDEX			"155"
	SOF_TKN_DAI_DIRECTION			"156"
}

SectionVendorTokens."sof_sched_tokens" {
	SOF_TKN_SCHED_PERIOD			"200"
	SOF_TKN_SCHED_PRIORITY			"201"
	SOF_TKN_SCHED_MIPS			"202"
	SOF_TKN_SCHED_CORE			"203"
	SOF_TKN_SCHED_FRAMES			"204"
	SOF_TKN_SCHED_TIME_DOMAIN		"205"
}

SectionVendorTokens."sof_volume_tokens" {
	SOF_TKN_VOLUME_RAMP_STEP_TYPE		"250"
	SOF_TKN_VOLUME_RAMP_STEP_MS		"251"
}

SectionVendorTokens."sof_src_tokens" {
	SOF_TKN_SRC_RATE_IN			"300"
	SOF_TKN_SRC_RATE_OUT			"301"
}

SectionVendorTokens."sof_pcm_tokens" {
	SOF_TKN_PCM_DMAC_CONFIG			"353"
}

SectionVendorTokens."sof_comp_tokens" {
	SOF_TKN_COMP_PERIOD_SINK_COUNT		"400"
	SOF_TKN_COMP_PERIOD_SOURCE_COUNT	"401"
	SOF_TKN_COMP_FORMAT			"402"
# Token retired with ABI 3.2, do not use for new capabilities
#	SOF_TKN_COMP_PRELOAD_COUNT		"403"
}

SectionVendorTokens."sof_ssp_tokens" {
	SOF_TKN_INTEL_SSP_CLKS_CONTROL		"500"
	SOF_TKN_INTEL_SSP_MCLK_ID		"501"
	SOF_TKN_INTEL_SSP_SAMPLE_BITS		"502"
	SOF_TKN_INTEL_SSP_FRAME_PULSE_WIDTH 	"503"
	SOF_TKN_INTEL_SSP_QUIRKS		"504"
	SOF_TKN_INTEL_SSP_TDM_PADDING_PER_SLOT  "505"
	SOF_TKN_INTEL_SSP_BCLK_DELAY		"506"
}

SectionVendorTokens."sof_dmic_tokens" {
	SOF_TKN_INTEL_DMIC_DRIVER_VERSION	"600"
	SOF_TKN_INTEL_DMIC_CLK_MIN		"601"
	SOF_TKN_INTEL_DMIC_CLK_MAX		"602"
	SOF_TKN_INTEL_DMIC_DUTY_MIN		"603"
	SOF_TKN_INTEL_DMIC_DUTY_MAX		"604"
	SOF_TKN_INTEL_DMIC_NUM_PDM_ACTIVE	"605"
	SOF_TKN_INTEL_DMIC_SAMPLE_RATE		"608"
	SOF_TKN_INTEL_DMIC_FIFO_WORD_LENGTH	"609"
	SOF_TKN_INTEL_DMIC_UNMUTE_RAMP_TIME_MS	"610"
}

SectionVendorTokens."sof_dmic_pdm_tokens" {
	SOF_TKN_INTEL_DMIC_PDM_CTRL_ID		"700"
	SOF_TKN_INTEL_DMIC_PDM_MIC_A_Enable	"701"
	SOF_TKN_INTEL_DMIC_PDM_MIC_B_Enable	"702"
	SOF_TKN_INTEL_DMIC_PDM_POLARITY_A	"703"
	SOF_TKN_INTEL_DMIC_PDM_POLARITY_B	"704"
	SOF_TKN_INTEL_DMIC_PDM_CLK_EDGE		"705"
	SOF_TKN_INTEL_DMIC_PDM_SKEW		"706"
}

SectionVendorTokens."sof_tone_tokens" {
	SOF_TKN_TONE_SAMPLE_RATE		"800"
}

SectionVendorTokens."sof_process_tokens" {
	SOF_TKN_PROCESS_TYPE			"900"
}

SectionVendorTokens."sof_sai_tokens" {
	SOF_TKN_IMX_SAI_MCLK_ID			"1000"
}

SectionVendorTokens."sof_esai_tokens" {
	SOF_TKN_IMX_ESAI_MCLK_ID		"1100"
}

SectionVendorTokens."sof_stream_tokens" {
	SOF_TKN_STREAM_PLAYBACK_COMPATIBLE_D0I3		"1200"
	SOF_TKN_STREAM_CAPTURE_COMPATIBLE_D0I3		"1201"
}

SectionVendorTokens."sof_led_tokens" {
	SOF_TKN_MUTE_LED_USE			"1300"
	SOF_TKN_MUTE_LED_DIRECTION		"1301"
}


# Include Apollolake DSP configuration
#
# Broxton differentiation for pipelines and components
#
















# Low Latency PCM Configuration
SectionVendorTuples."pipe_ll_schedule_plat_tokens" {
	tokens "sof_sched_tokens"

	tuples."word" {
		SOF_TKN_SCHED_MIPS	"50000"
		
	}
}

SectionData."pipe_ll_schedule_plat" {
	tuples "pipe_ll_schedule_plat_tokens"
}

# Media PCM Configuration
SectionVendorTuples."pipe_media_schedule_plat_tokens" {
	tokens "sof_sched_tokens"

	tuples."word" {
		SOF_TKN_SCHED_MIPS	"100000"
		
	}
}

SectionData."pipe_media_schedule_plat" {
	tuples "pipe_media_schedule_plat_tokens"
}

# Tone Signal Generator Configuration
SectionVendorTuples."pipe_tone_schedule_plat_tokens" {
	tokens "sof_sched_tokens"

	tuples."word" {
		SOF_TKN_SCHED_MIPS	"200000"
		
	}
}

SectionData."pipe_tone_schedule_plat" {
	tuples "pipe_tone_schedule_plat_tokens"
}

# DAI schedule Configuration - scheduled by IRQ
SectionVendorTuples."pipe_dai_schedule_plat_tokens" {
	tokens "sof_sched_tokens"

	tuples."word" {
		SOF_TKN_SCHED_MIPS	"5000"
		
	}
}

SectionData."pipe_dai_schedule_plat" {
	tuples "pipe_dai_schedule_plat_tokens"
}



#
# Define the pipelines
#
# PCM6 <---- volume <----- DMIC01 (dmic0 capture)
#


# Passthrough capture pipeline 1 on PCM 1 using max 4 channels.
# 1000us deadline on core 0 with priority 0




























# Capture Passthrough Pipeline and PCM
#
# Pipeline Endpoints for connection are :-
#
#  host PCM_C <-- B0 <-- sink DAI0

# Include topology builder




































 


























#
# Components and Buffers
#

# Host "Passthrough Capture" PCM
# with 0 sink and 2 source periods
SectionVendorTuples."PCM1C_tuples_w_comp" {
	tokens "sof_comp_tokens"
	tuples."word" {
		SOF_TKN_COMP_PERIOD_SINK_COUNT		"0"
		SOF_TKN_COMP_PERIOD_SOURCE_COUNT	"2"
	}
}
SectionData."PCM1C_data_w_comp" {
	tuples "PCM1C_tuples_w_comp"
}
SectionWidget."PCM1C" {
	index "1"
	type "aif_out"
	no_pm "true"
	stream_name "Passthrough Capture 1"
	data [
		"PCM1C_data_w_comp"
	]
}

# Capture Buffers
SectionVendorTuples."BUF1.0_tuples" {
	tokens "sof_buffer_tokens"
	tuples."word" {
		SOF_TKN_BUF_SIZE	"1536"
		SOF_TKN_BUF_CAPS	"  113"
	}
}
SectionData."BUF1.0_data" {
	tuples "BUF1.0_tuples"
}
SectionWidget."BUF1.0" {
	index "1"
	type "buffer"
	no_pm "true"
	data [
		"BUF1.0_data"
	]
}

#
# Pipeline Graph
#
#  host PCM_C <-- B0 <-- sink DAI0

SectionGraph."pipe-pass-capture-1" {
	index "1"

	lines [
		"PCM1C, , BUF1.0"
		
	]
}

#
# Pipeline Source and Sinks
#



#
# PCM Configuration
#

SectionPCMCapabilities."Passthrough Capture 1" {

	formats "S32_LE"
	rate_min "48000"
	rate_max "48000"
	channels_min "4"
	channels_max "4"
	periods_min "2"
	periods_max "16"
	period_size_min	"192"
	period_size_max	"16384"
	buffer_size_min	"65536"
	buffer_size_max	"65536"
}





#
# DAIs configuration
#



# capture DAI is DMIC 0 using 2 periods
# Buffers use s32le format, 1000us deadline on core 0 with priority 0























# DAI Capture connector

# Include topology builder




































 
























#
# DAI definitions
#
SectionVendorTuples."DMIC0.IN_tuples_w_comp" {
	tokens "sof_comp_tokens"
	tuples."word" {
		SOF_TKN_COMP_PERIOD_SINK_COUNT		"2"
		SOF_TKN_COMP_PERIOD_SOURCE_COUNT	"0"
	}
}
SectionData."DMIC0.IN_data_w_comp" {
	tuples "DMIC0.IN_tuples_w_comp"
}
SectionVendorTuples."DMIC0.IN_tuples_w" {
	tokens "sof_dai_tokens"
	tuples."word" {
		SOF_TKN_DAI_INDEX	"0"
		SOF_TKN_DAI_DIRECTION	"1"
	}
}
SectionData."DMIC0.IN_data_w" {
	tuples "DMIC0.IN_tuples_w"
}
SectionVendorTuples."DMIC0.IN_tuples_str" {
	tokens "sof_dai_tokens"
	tuples."string" {
		SOF_TKN_DAI_TYPE	"DMIC"
	}
}
SectionData."DMIC0.IN_data_str" {
	tuples "DMIC0.IN_tuples_str"
}
SectionVendorTuples."DMIC0.IN_tuples_comp_str" {
	tokens "sof_comp_tokens"
	tuples."string" {
		SOF_TKN_COMP_FORMAT	"s32le"
	}
}
SectionData."DMIC0.IN_data_comp_str" {
	tuples "DMIC0.IN_tuples_comp_str"
}
SectionWidget."DMIC0.IN" {
	index "1"
	type "dai_out"
	stream_name "dmic01"
	no_pm "true"
	data [
		"DMIC0.IN_data_w"
		"DMIC0.IN_data_w_comp"
		"DMIC0.IN_data_str"
		"DMIC0.IN_data_comp_str"
	]
}

#
# DAI pipeline - always use 0 for DAIs
#
SectionVendorTuples."PIPELINE.1.DMIC0.IN_tuples" {
	tokens "sof_sched_tokens"
	tuples."word" {
		SOF_TKN_SCHED_PERIOD		"1000"
		SOF_TKN_SCHED_PRIORITY		"0"
		SOF_TKN_SCHED_CORE		"0"
		SOF_TKN_SCHED_FRAMES		"0"
		SOF_TKN_SCHED_TIME_DOMAIN	"1"
	}
}
SectionData."PIPELINE.1.DMIC0.IN_data" {
	tuples "PIPELINE.1.DMIC0.IN_tuples"
}
SectionWidget."PIPELINE.1.DMIC0.IN" {
	index "1"
	type "scheduler"
	no_pm "true"
	stream_name "DMIC0.IN"
	data [
		"PIPELINE.1.DMIC0.IN_data"
		"pipe_dai_schedule_plat"
	]
}

#
# Graph connections to pipelines

SectionGraph."DMIC0" {
	index "1"

	lines [
		"BUF1.0, , DMIC0.IN"
		
	]
}









SectionPCM."DMIC01" {

	# used for binding to the PCM
	id "1"

	dai."DMIC01 1" {
		id "1"
	}

	pcm."capture" {

		capabilities "Passthrough Capture 1"
	}

}



#
# BE configurations - overrides config in ACPI if present
#


SectionHWConfig."DMIC0" {

	id		"1"

	}
SectionVendorTuples."DAICONFIG.DMIC0_dmic_tuples" {
	tokens "sof_dmic_tokens"
	tuples."word" {
		SOF_TKN_INTEL_DMIC_DRIVER_VERSION	"1"
		SOF_TKN_INTEL_DMIC_CLK_MIN		"500000"
		SOF_TKN_INTEL_DMIC_CLK_MAX		"4800000"
		SOF_TKN_INTEL_DMIC_DUTY_MIN		"40"
		SOF_TKN_INTEL_DMIC_DUTY_MAX		"60"
		SOF_TKN_INTEL_DMIC_SAMPLE_RATE		"48000"
		SOF_TKN_INTEL_DMIC_FIFO_WORD_LENGTH	"32"
		SOF_TKN_INTEL_DMIC_UNMUTE_RAMP_TIME_MS	"400"

		SOF_TKN_INTEL_DMIC_NUM_PDM_ACTIVE	"2"
	}
}
SectionVendorTuples."DAICONFIG.DMIC0_pdm_tuples" {
	tokens "sof_dmic_pdm_tokens"
	tuples."short.pdm0" {
		SOF_TKN_INTEL_DMIC_PDM_CTRL_ID		"0"
		SOF_TKN_INTEL_DMIC_PDM_MIC_A_Enable	"1"
		SOF_TKN_INTEL_DMIC_PDM_MIC_B_Enable	"1"
		SOF_TKN_INTEL_DMIC_PDM_POLARITY_A	"0"
		SOF_TKN_INTEL_DMIC_PDM_POLARITY_B	"0"
		SOF_TKN_INTEL_DMIC_PDM_CLK_EDGE	"0"
		SOF_TKN_INTEL_DMIC_PDM_SKEW		"0"
	}

	tuples."short.pdm1" {
		SOF_TKN_INTEL_DMIC_PDM_CTRL_ID		"1"
		SOF_TKN_INTEL_DMIC_PDM_MIC_A_Enable	"1"
		SOF_TKN_INTEL_DMIC_PDM_MIC_B_Enable	"1"
		SOF_TKN_INTEL_DMIC_PDM_POLARITY_A	"0"
		SOF_TKN_INTEL_DMIC_PDM_POLARITY_B	"0"
		SOF_TKN_INTEL_DMIC_PDM_CLK_EDGE	"0"
		SOF_TKN_INTEL_DMIC_PDM_SKEW		"0"
	}


}

SectionData."DAICONFIG.DMIC0_pdm_data" {
	tuples "DAICONFIG.DMIC0_pdm_tuples"
}
SectionData."DAICONFIG.DMIC0_data" {
	tuples "DAICONFIG.DMIC0_dmic_tuples"

}

SectionVendorTuples."DAICONFIG.DMIC0_tuples_common" {
	tokens "sof_dai_tokens"
	tuples."string" {
		SOF_TKN_DAI_TYPE		"DMIC"
	}
	tuples."word" {
		SOF_TKN_DAI_INDEX		"0"
	}
}
SectionData."DAICONFIG.DMIC0_data_common" {
	tuples "DAICONFIG.DMIC0_tuples_common"
}

SectionBE."dmic01" {
	id "1"
	index "0"
	default_hw_conf_id	"1"

	hw_configs [
		"DMIC0"
	]
	data [
		"DAICONFIG.DMIC0_data"
		"DAICONFIG.DMIC0_data_common"
		"DAICONFIG.DMIC0_pdm_data"
	]
}



